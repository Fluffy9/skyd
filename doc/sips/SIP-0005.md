# SIP-0005: Fund Ephemeral Account RPC

## Description

Ephemeral accounts are a service offered by hosts that allow users to connect a
balance to a pubkey. Users can deposit funds into an ephemeral account with a
host and then later use the funds to transact with the host. The most common
transactions will be uploading and downloading data, however any RPC that
requires payment will support receiving payment from an ephemeral account.

Ephemeral accounts are only useful when it is possible to deposit money into
them, and spend that money afterwards. To enable users to deposit funds into
their ephemeral accounts the host provides a custom RPC call.

Note that this RPC ties in with the `ForwardPaymentRPC`. Together, they allow a
user to route payment through a series of interconnected hosts. This way the
user is able to transfer funds to a host with which he does not necessarily
share a file contract. He can then use the funds to download data from that host
directly.

## Motivation

The main motivation for this SIP is ephemeral accounts. Without a means to fund
the accounts, they would be useless. Ephemeral accounts are motivated mainly by
download latency. By allowing money to be put into an ephemeral account, from
which you can spend and pay for subsequent RPC requests, we eliminate any
latency.

## FundEphemeralAccountRPC

In order to fund an ephemeral account, the user needs to specify the account id.
Every detail related to the actual payment, meaning how it is paid for and how
much, is obfuscated by the `extractPaymentFromRPC` library function and is
outside the scope of this SIP. This means that an ephemeral account can be
funded through both a file contract or another ephemeral account.

If the payment was successful, the host will respond to the user with a
signature. This signature is called a receipt, and it covers the account id that
received funding and the amount that got funded (after subtracting the fee). The
caller can use this receipt to prove to others it successfully made payment and
it was accepted by the host.

This receipt is necessary in order for the caller to prove payment was made.
Imagine a scenario where a user wants to route payment through one host on to
the next, he can do so by using the forward payment RPC. However, once he has
paid the host to forward payment, he has no way of knowing if the host actually
forwarded the money or pocketed it. The host could lie and say he sent it along,
but did not. Using these receipts the user can essentially perform payment
verification.

```Go
type fundEphemeralAccountRequest {
    Id string // ephemeral account id
}

type fundEphemeralAccountResponse {
    Signature []byte // receipt
}

func (h *Host) managedRPCFundEphemeralAccount(conn net.Conn) error {
    // read fundEphemeralAccountRequest -> id
    // extractPaymentFromRPC -> amount
    // extract fee (based on RPC price table)
    // callDeposit(id, amount - fee)
    // write fundEphemeralAccountResponse
}
```