# Start with golang image
FROM golang:1.15 AS base

# List SkynetLabs as the maintainer
LABEL maintainer="SkynetLabs <devs@siasky.net>"

# We want this to run on linux/amd64
ENV GOOS linux
ENV GOARCH amd64

# Enable go modules
ENV GO111MODULE on

# Set the working Directory
WORKDIR /root

# Initialize the linx container
RUN apt-get update && \
    apt-get -y install python3-pip && \
    apt-get clean && \
    wget -O- -nv https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s v1.30.0 && \
    pip3 install codespell && \
    go get gitlab.com/NebulousLabs/analyze

# Copy the code files into the docker container
ADD . /root/skyd

# cd into the skyd repo 
RUN cd skyd 

# Run the tests
FROM base AS test
RUN make test 

FROM base AS test-long
RUN make test-long 

FROM base AS test-vlong
RUN make test-vlong 

